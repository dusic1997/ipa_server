# IPA Server - 局域网 iOS 应用安装服务器

一个简单易用的本地网络 IPA 安装服务器，支持拖拽上传 IPA 文件并通过 OTA（Over-The-Air）方式安装到 iOS 设备。

![主界面预览](public/screenshot.png)

---

## ⚠️ 核心使用流程（必读）

iOS 应用的安装需要两个步骤，并使用不同的协议及端口：

1.  **第一步（HTTP）**：访问 `http://192.168.1.xxx:3080/certs/ca.crt` 下载并信任证书。
2.  **第二步（HTTPS）**：访问 `https://192.168.1.xxx:3000` 上传并安装应用。

> **为什么一定要安证书？**
> iOS OTA（隔空安装）协议强制要求服务器必须使用 HTTPS。由于我们是在局域网使用自签名证书，iOS 设备必须手动信任该证书的颁发机构 (CA)，否则无法安装应用。

---

## ✨ 功能特性

- 🚀 **拖拽上传** - 支持拖放 IPA 文件快速上传
- 📱 **OTA 安装** - 通过 Safari 直接安装到 iOS 设备
- 📷 **二维码安装** - 扫码即可安装，无需手动输入地址
- 🔐 **HTTPS 支持** - 自动生成自签名证书
- 🎨 **现代 UI** - 深色主题，响应式设计
- 📦 **应用管理** - 查看、删除已上传的应用

---

## 🛠 技术栈

| 组件 | 技术 |
|------|------|
| 后端 | Node.js + Express |
| 文件上传 | Multer |
| IPA 解析 | JSZip + bplist-parser |
| HTTPS | OpenSSL 自签名证书 |
| 前端 | HTML + CSS + JavaScript |

---

## 🚀 快速开始

### 1. 安装依赖

```bash
cd ipa_server
npm install
```

### 2. 生成 SSL 证书

```bash
npm run generate-cert
```

执行后会提示输入本机 IP 地址（如果自动检测失败）。

### 3. 启动服务器

```bash
npm start
```

---

## 📱 iOS 设备配置与安装指南（详细图文版）

### 第一阶段：证书安装与信任（HTTP）

**1. 下载证书描述文件**
- 确保 iOS 设备连接到同一局域网。
- 打开 **Safari 浏览器**。
- 访问 HTTP 地址（注意端口是 **3080**）：
  ```
  http://<服务器IP>:3080/certs/ca.crt
  ```
  *(例如: http://192.168.1.100:3080/certs/ca.crt)*
- 弹窗提示“此网站正尝试下载配置描述文件”，点击 **【允许】**。
- 提示“已下载描述文件”，点击 **【关闭】**。

**2. 安装描述文件**
- 打开设备 **【设置】**。
- 点击顶部的 **【已下载描述文件】**（或前往 通用 -> VPN与设备管理）。
- 选择 **IPA Server CA**。
- 点击右上角 **【安装】** -> 输入锁屏密码 -> 再次点击 **【安装】** -> 点击底部的 **【安装】**。
- 点击右上角 **【完成】**。

**3. 信任证书（关键步骤！）**
- 前往 **【设置】** -> **【通用】** -> **【关于本机】**。
- 拉到最底部，点击 **【证书信任设置】**。
- 在“针对根证书启用完全信任”下，找到 **IPA Server CA**。
- **打开开关** -> 在弹窗中点击 **【继续】**。

> ❌ 如果跳过第3步，点击安装应用时会提示“无法连接到服务器”或没有任何反应。

---

### 第二阶段：安装应用（HTTPS）

**1. 访问安装页面**
- 在 Safari 浏览器中访问 HTTPS 地址（注意端口是 **3000**）：
  ```
  https://<服务器IP>:3000
  ```
  *(例如: https://192.168.1.100:3000)*
- 如果提示“此连接非私人连接”，点击 **【显示详细信息】** -> **【访问此网站】**。

**2. 安装流程**
- **上传**：在电脑端网页上传 IPA 文件。
- **安装**：
  - **方法A**：在 iOS 页面列表中找到应用，点击 **【安装】** 按钮。
  - **方法B**：点击应用卡片上的 **【安装】**，使用 iOS 相机扫描二维码。
- 弹窗提示“要在线安装 xxx 吗？”，点击 **【安装】**。
- 回到桌面，查看应用安装进度。

---

## ❓ 常见问题

### Q: 为什么点击安装没有反应？
**A:** 请检查以下三点：
1. 必须使用 **Safari 浏览器**。
2. 必须完成**证书信任**步骤（设置->通用->关于本机->证书信任设置）。
3. 确保访问的是 HTTPS 地址 (端口 3000)。

### Q: 提示“无法验证服务器身份”？
**A:** 说明证书未被信任。请重新执行“第三步：信任证书”。

### Q: 应用安装后图标一直是灰色的或提示“无法安装”？
**A:** 可能是 IPA 签名问题：
1. 确保证书未过期。
2. 如果是个人/Ad-Hoc 签名，确保设备的 UDID 包含在描述文件中。
3. 确保 iOS 版本符合应用的最低系统要求。

---

## 📄 License

MIT License
